<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ã€ãƒ†ãƒ¼ãƒ 6ã€‘DOM-based XSS æ¤œè¨¼</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background-color: #f8f8f8; }
        .container { max-width: 700px; margin: 0 auto; background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .result-box { margin-top: 20px; padding: 15px; border: 2px dashed #ff9900; background-color: #fffaf0; }
        .payload-box { margin-top: 30px; padding: 10px; border: 1px dashed #007bff; background-color: #e6f7ff; }
        pre { background-color: #fff; padding: 5px; border: 1px solid #ddd; white-space: pre-wrap; }
        .warning { color: #c00; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #ff9900;">âš¡ ã€ãƒ†ãƒ¼ãƒ 6ã€‘DOM-based XSS</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€URLã®ãƒãƒƒã‚·ãƒ¥ï¼ˆ#ä»¥é™ï¼‰ã‚’ç„¡æ¤œæŸ»ã§ DOM ã«æ›¸ãè¾¼ã‚“ã§ã„ã¾ã™ã€‚</p>
        
        <div class="result-box">
            <h2>ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰ã®æŒ¿å…¥çµæœ:</h2>
            <div id="result">
                <!-- â˜…â˜…â˜… ã“ã“ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼ˆãƒãƒƒã‚·ãƒ¥å€¤ï¼‰ãŒç„¡æ¤œæŸ»ã§æŒ¿å…¥ã•ã‚Œã‚‹ â˜…â˜…â˜… -->
                ãƒãƒƒã‚·ãƒ¥å€¤ãŒã‚ã‚Šã¾ã›ã‚“ã€‚URLã®æœ«å°¾ã« `#<ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰>` ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
            </div>
        </div>

        <div class="payload-box">
            <strong>ğŸ’¡ æ¤œè¨¼ç”¨ DOM-XSS ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä¾‹ï¼š</strong>
            <pre>#&lt;img src=x onerror=alert('DOM-XSSæˆåŠŸï¼')&gt;</pre>
            <p class="warning">
                â€» ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å…ˆé ­ã«ã¯ã€Œ#ã€ã‚’ä»˜ã‘ã¦ãã ã•ã„ã€‚<br>
                ä¾‹: ãƒšãƒ¼ã‚¸URL/dom_xss.html<span style="color: #ff0000; font-weight: bold;">#&lt;img src=x onerror=alert('DOM-XSSæˆåŠŸï¼')&gt;</span>
            </p>
        </div>
    </div>

    <script>
        // 1. URLã®ãƒãƒƒã‚·ãƒ¥ï¼ˆ#ä»¥é™ï¼‰ã‚’å–å¾—ã™ã‚‹
        const rawHash = window.location.hash.substring(1); // #ã‚’å‰Šé™¤
        const resultElement = document.getElementById('result');

        alert('å–å¾—ã—ãŸãƒãƒƒã‚·ãƒ¥å€¤ (rawHash): \n\n' + rawHash);

        if (rawHash) {
            let hash;

            try {
                // rawHash ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€HTMLã‚¿ã‚°ã«æˆ»ã™
                hash = decodeURI(rewHash);

                alert('ãƒ‡ã‚³ãƒ¼ãƒ‰æˆåŠŸã—ãŸãƒãƒƒã‚·ãƒ¥å€¤ (hash): \n\n' + hash);
            } catch(e) {
               ã€€// ãƒ‡ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ãŸå ´åˆã¯ã€ã¨ã‚Šã‚ãˆãš rawHashã‚’ã‚»ãƒƒãƒˆã™ã‚‹
                hash = rawHash;

                alert('ãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•—ã—ãŸãƒãƒƒã‚·ãƒ¥å€¤ (hash): \n\n' + hash);
            } 

            // â˜…â˜…â˜… è„†å¼±ãªå‡¦ç† â˜…â˜…â˜…
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ãƒã‚§ãƒƒã‚¯ã›ãšã«ã€innerHTMLã«ç›´æ¥æ›¸ãè¾¼ã‚€
            resultElement.innerHTML = hash;
            
            // æŒ¿å…¥ã•ã‚ŒãŸå¾Œã«ã€å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¶ˆã™
            resultElement.insertAdjacentHTML('afterbegin', '<strong>æŒ¿å…¥ã•ã‚ŒãŸå€¤: </strong>');
        }
    </script>
</body>
</html>
