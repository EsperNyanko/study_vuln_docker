<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ã€ãƒ†ãƒ¼ãƒ 4ã€‘åå°„å‹ XSS (ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å¯¾ç­–ç‰ˆ)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .payload-box {
            margin-top: 20px;
            padding: 10px;
            border: 1px dashed #007bff;
            background-color: #e6f7ff;
        }
        pre {
            background-color: #fff; 
            padding: 5px; 
            border: 1px solid #ddd; 
            overflow-x: auto;
            white-space: pre-wrap; /* é•·ã„ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§ã‚‚æŠ˜ã‚Šè¿”ã—ã‚’å¯èƒ½ã«ã™ã‚‹ */
        }
        .warning { color: #c00; }
    </style>
</head>
<body>
    <h1>ğŸ” åå°„å‹ XSS æ¤œè¨¼ãƒšãƒ¼ã‚¸ (XSSå¯¾ç­–ç‰ˆ)</h1>

    <form action="reflected_xss_form_simple_escape.html" method="GET">
        <label for="query">ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥åŠ›:</label>
        <input type="text" name="q" size="60" required>
        <button type="submit">é€ä¿¡</button>
    </form>
    
    <div class="payload-box">
        <strong>ğŸ’¡ æ¤œè¨¼ç”¨ XSS ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä¾‹ï¼š</strong>
        <pre>
            1. &lt;script&gt;alert('Hello!')&lt;/script&gt;
            2. &lt;img src=x onerror=alert('XSSæˆåŠŸï¼')&gt;</pre>
        <p class="warning">
            â€» 1ç•ªç›®ã®ä¾‹ã§ã‚‚ç™ºå‹•ã™ã‚‹ã¯ãšã§ã™ (document.write()ä½¿ç”¨)ã€‚ç™ºå‹•ã—ãªã„å ´åˆã¯ã€2ç•ªç›®ã®ä¾‹ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚<br>
            â€» ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã€ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã«è²¼ã‚Šä»˜ã‘ã¦é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>
    </div>
    
    <hr>
    
    <h3>åå°„çµæœ:</h3>

    <script>
        // â˜… XSSé˜²å¾¡ç­– â˜…: HTMLç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹é–¢æ•°ã‚’è¿½åŠ 
        const escapeHtml = (unsafe) => {
            if (!unsafe) return '';

            return unsafe.replace(/[&<>"']/g, function(match) {
                const replacements = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                };
                return replacements[match];
            });
        }; 

        // 1. URLã‹ã‚‰ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ 'q' ã®å€¤ã‚’å–å¾—
        const params = new URLSearchParams(window.location.search);
        const query = params.get('q');
        
        if (query) {
            const decodedQuery = decodeURIComponent(query.replace(/\+/g, ' '));

            // â˜… ä¿®æ­£ç®‡æ‰€ 1 â˜…: è„†å¼±æ€§ã«é–¢ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¯¾ç­–ç‰ˆã«å¤‰æ›´
            document.write('<h1>âœ… XSSå¯¾ç­–æ¸ˆã¿ãƒšãƒ¼ã‚¸</h1>');
            document.write('<div style="color: green; font-weight: bold;">ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚</div><hr>');
            
            // â˜… ä¿®æ­£ç®‡æ‰€ 2 â˜…: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã‚’é©ç”¨
            const safeQuery = escapeHtml(decodedQuery);

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’HTMLã‚¹ãƒˆãƒªãƒ¼ãƒ ã«æ›¸ãè¾¼ã‚€ãŒã€ç„¡å®³åŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®Ÿè¡Œã•ã‚Œãªã„
            document.write('ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› (å®‰å…¨): ' + safeQuery);

            document.write('<div style="margin-top: 20px;">ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒãã®ã¾ã¾ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>');
            // NOTE: document.write() ã®å¾Œã§ãƒšãƒ¼ã‚¸ã®å†…å®¹ãŒã™ã¹ã¦ç½®ãæ›ã‚ã‚‹ãŸã‚ã€
            // ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆä»¥é™ã®HTMLã¯é€šå¸¸ã€è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚
        }
    </script>
</body>
</html>
